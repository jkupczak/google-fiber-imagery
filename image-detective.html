<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Image Most Frequent Color Analyzer</title>
</head>
<body>
  <h1>Image Most Frequent Color Analyzer!</h1>
  <p>Paste a list of image URLs (one per line):</p>
  <textarea id="urlInput" rows="10" cols="80"></textarea><br><br>
  <button id="analyzeBtn">Analyze Images</button>
  <p id="status"></p>
  <p>Results:</p>
  <textarea id="jsonOutput" rows="15" cols="80"></textarea>

  <script>
  const CORS_PROXY = "https://cors-anywhere.herokuapp.com/";

  function rgbToHex(r, g, b) {
    return "#" + [r, g, b].map(x => x.toString(16).padStart(2, '0')).join('');
  }

  async function analyzeImage(url) {
    return new Promise((resolve, reject) => {
      const img = new Image();
      img.crossOrigin = "Anonymous";
      img.onload = () => {
        const canvas = document.createElement("canvas");
        canvas.width = img.width;
        canvas.height = img.height;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(img, 0, 0);

        const data = ctx.getImageData(0, 0, img.width, img.height).data;
        const colorCounts = {};
        let hasAlpha = false;

        for (let i = 0; i < data.length; i += 4) {
          const r = data[i];
          const g = data[i+1];
          const b = data[i+2];
          const a = data[i+3];

          if (a < 255) {
            hasAlpha = true;
            continue; // ignore non-opaque pixels
          }

          const hex = rgbToHex(r, g, b);
          colorCounts[hex] = (colorCounts[hex] || 0) + 1;
        }

        // Find the most frequent hex
        let most_frequent_hex = null;
        let maxCount = 0;
        for (const [hex, count] of Object.entries(colorCounts)) {
          if (count > maxCount) {
            maxCount = count;
            most_frequent_hex = hex;
          }
        }

        resolve({
          url,
          width: img.width,
          height: img.height,
          has_alpha: hasAlpha,
          most_frequent_hex
        });
      };
      img.onerror = () => reject(new Error(`Failed to load image: ${url}`));
      img.src = CORS_PROXY + url;
    });
  }

  async function analyzeImages(urls) {
    const results = [];
    const status = document.getElementById("status");
    for (let i = 0; i < urls.length; i++) {
      const url = urls[i].trim();
      if (!url) continue;
      status.textContent = `Processing ${i+1} of ${urls.length}: ${url}`;
      try {
        const result = await analyzeImage(url);
        results.push(result);
      } catch (err) {
        console.error("Error processing:", url, err);
      }
    }
    status.textContent = `Processing complete. ${results.length} images analyzed.`;
    return results;
  }

  document.getElementById("analyzeBtn").addEventListener("click", async () => {
    const textarea = document.getElementById("urlInput");
    const urls = textarea.value.split("\n");
    const results = await analyzeImages(urls);
    const output = document.getElementById("jsonOutput");
    output.value = JSON.stringify(results, null, 2);
    try {
      await navigator.clipboard.writeText(JSON.stringify(results, null, 2));
      alert("JSON copied to clipboard!");
    } catch (err) {
      console.error("Failed to copy JSON to clipboard:", err);
    }
  });
  </script>
</body>
</html>
