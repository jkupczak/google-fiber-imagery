<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Image Grid with Multi-Filters, Resize, Sort</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
.filters { margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
.filter-button { padding: 8px 12px; margin: 5px; border: 2px solid #ccc; cursor: pointer; border-radius: 4px; background: #f9f9f9; }
.filter-button.active { outline: 3px solid #000; outline-offset: 2px; }
.color-filter { width: 30px; height: 30px; border-radius: 50%; border: 2px solid #ccc; margin: 5px; cursor: pointer; display: inline-block; }
.color-filter.active { outline: 3px solid #000; outline-offset: 2px; }
.color-bw { background: linear-gradient(to right, #000 50%, #fff 50%); }
.grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; }
.image-wrapper { position: relative; display: flex; flex-direction: column; justify-content: flex-start; align-items: center; background: #f0f0f0; border: 1px solid #ddd; overflow: hidden; }
.image-wrapper img { width: 100%; height: 100%; object-fit: contain; display: block; }
.button-container { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: flex; flex-direction: column; gap: 4px; opacity: 0; transition: opacity 0.2s; align-items: center; pointer-events: none; }
.image-wrapper:hover .button-container { opacity: 1; pointer-events: auto; }
.copy-btn { padding: 2px 6px; font-size: 0.8em; cursor: pointer; border: 1px solid #ccc; border-radius: 3px; background: #f9f9f9; white-space:nowrap }
.size-controls { margin-bottom: 20px; }
.size-controls button { margin: 0 5px; padding: 6px 10px; border: 2px solid #ccc; background: #f9f9f9; cursor: pointer; border-radius: 4px; }
.sort-controls { margin-bottom: 20px; display: flex; gap: 10px; align-items: center; }
#versionInfo { position: fixed; top: 10px; right: 10px; font-size: 0.9em; color: #555; background: rgba(255,255,255,0.9); padding: 5px 10px; border: 1px solid #ccc; border-radius: 4px; z-index: 1000; }
</style>
</head>
<body>

<div class="filters">
  <div>
    <button class="filter-button" data-type="gif">GIF</button>
    <button class="filter-button" data-type="jpg">JPG</button>
    <button class="filter-button" data-type="png">PNG</button>
     <button class="filter-button" id="hardwareFilter">Hardware</button>
  </div>
  <div>
    <button class="filter-button" data-alpha="true">Has Transparency</button>
    <button class="filter-button" data-complex="true">Only Complex Colors</button>
  </div>
  <div>
    <button class="filter-button clear-colors">Clear Colors</button>
    <div class="color-filters"></div>
  </div>
</div>

<div class="sort-controls">
  <label for="sortSelect">Sort by Total Unique Colors:</label>
  <select id="sortSelect">
    <option value="asc">Ascending</option>
    <option value="desc">Descending</option>
  </select>
</div>

<div class="size-controls">
  <button id="decrease">-</button>
  <span>Adjust Image Size</span>
  <button id="increase">+</button>
</div>

<div class="grid" id="imageGrid"></div>

<div id="versionInfo">Version 9 | 09/26/25, 15:40:00</div>

<script>
const themeColors = {
  green: "#34A853",
  blue: "#4285F4",
  yellow: "#FBBC04",
  red: "#EA4335",
  gray: "#5f6469",
  black: "#000000",
  white: "#ffffff"
};

let currentSize = 120;
let allImages = [];
let activeFileFilters = new Set();
let activeAlphaFilter = null;
let activeThemeFilter = null;
let activeComplexFilter = null;
let sortOrder = "";
let activeHardwareFilter = false;

async function loadImages() {
  const res = await fetch("https://raw.githubusercontent.com/jkupczak/google-fiber-imagery/refs/heads/main/images.json");
  const data = await res.json();
  allImages = data;
  renderThemeFilters(data);
  renderImages();
}

function renderThemeFilters(data) {
  const container = document.querySelector(".color-filters");
  container.innerHTML = "";

  const themes = [...new Set(data.map(img => img.theme && img.theme.toLowerCase()))]
    .filter(theme => theme && themeColors[theme] && theme !== "black" && theme !== "white");

  themes.forEach(theme => {
    const btn = document.createElement("div");
    btn.className = "color-filter";
    btn.style.backgroundColor = themeColors[theme];
    btn.dataset.theme = theme;
    btn.addEventListener("click", () => {
      if (activeThemeFilter === theme) {
        activeThemeFilter = null;
        btn.classList.remove("active");
      } else {
        activeThemeFilter = theme;
        document.querySelectorAll(".color-filter").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
      }
      renderImages();
    });
    container.appendChild(btn);
  });

  // Combined black & white button
  const bwBtn = document.createElement("div");
  bwBtn.className = "color-filter color-bw";
  bwBtn.dataset.theme = "bw";
  bwBtn.addEventListener("click", () => {
    if (activeThemeFilter === "bw") {
      activeThemeFilter = null;
      bwBtn.classList.remove("active");
    } else {
      activeThemeFilter = "bw";
      document.querySelectorAll(".color-filter").forEach(b => b.classList.remove("active"));
      bwBtn.classList.add("active");
    }
    renderImages();
  });
  container.appendChild(bwBtn);
}

function renderImages() {
  const grid = document.getElementById("imageGrid");
  grid.style.gridTemplateColumns = `repeat(auto-fill, minmax(${currentSize}px, 1fr))`;
  grid.innerHTML = "";

  let filtered = allImages.filter(img => {
    if (img.theme === null || img.theme === "null") return false;

    let ext = img.url.split(".").pop().toLowerCase();
    if (ext === "jpeg") ext = "jpg";
    if (activeFileFilters.size && !activeFileFilters.has(ext)) return false;
    if (activeAlphaFilter !== null && img.has_alpha !== activeAlphaFilter) return false;
    if (activeComplexFilter !== null && img.complex !== activeComplexFilter) return false;
    if (activeThemeFilter) {
      if (activeThemeFilter === "bw") {
        if (!["black","white"].includes(img.theme.toLowerCase())) return false;
      } else if (img.theme.toLowerCase() !== activeThemeFilter) return false;
    }
    if (activeHardwareFilter && !(img.tags && img.tags.map(t => t.toLowerCase()).includes("hardware"))) return false; 
    return true;
  });

  // Sorting
  if(sortOrder==="asc") filtered.sort((a,b)=>a.total_unique_colors - b.total_unique_colors);
  else if(sortOrder==="desc") filtered.sort((a,b)=>b.total_unique_colors - a.total_unique_colors);

  filtered.forEach(img => {
    const wrapper = document.createElement("div");
    wrapper.className = "image-wrapper";
    wrapper.style.height = currentSize + "px";

    const buttonContainer = document.createElement("div");
    buttonContainer.className = "button-container";

    const copyURLBtn = document.createElement("button");
    copyURLBtn.textContent = "Copy URL";
    copyURLBtn.className = "copy-btn";
    copyURLBtn.addEventListener("click", async () => {
      try { await navigator.clipboard.writeText(img.url); copyURLBtn.textContent="Copied!"; setTimeout(()=>copyURLBtn.textContent="Copy URL",1000);} catch(e){console.error(e);}
    });

    const copyDetailsBtn = document.createElement("button");
    copyDetailsBtn.textContent = "Copy Data";
    copyDetailsBtn.className = "copy-btn";
    copyDetailsBtn.addEventListener("click", async () => {
      try { await navigator.clipboard.writeText(JSON.stringify(img,null,2)); copyDetailsBtn.textContent="Copied!"; setTimeout(()=>copyDetailsBtn.textContent="Copy Details",1000);} catch(e){console.error(e);}
    });

    buttonContainer.appendChild(copyURLBtn);
    buttonContainer.appendChild(copyDetailsBtn);
    wrapper.appendChild(buttonContainer);

    const image = document.createElement("img");
    image.src = img.url;
    wrapper.appendChild(image);

    grid.appendChild(wrapper);
  });
}

// File type filters
document.querySelectorAll(".filter-button[data-type]").forEach(btn=>{
  btn.addEventListener("click",()=>{
    const type=btn.dataset.type;
    if(activeFileFilters.has(type)){ activeFileFilters.delete(type); btn.classList.remove("active");}
    else{ activeFileFilters.add(type); btn.classList.add("active");}
    renderImages();
  });
});

// Alpha filter
document.querySelector(".filter-button[data-alpha]").addEventListener("click",e=>{
  if(activeAlphaFilter){ activeAlphaFilter=null; e.target.classList.remove("active");}
  else{ activeAlphaFilter=true; e.target.classList.add("active");}
  renderImages();
});

// Hardware filter
document.getElementById("hardwareFilter").addEventListener("click", (e) => {
  activeHardwareFilter = !activeHardwareFilter;
  e.target.classList.toggle("active", activeHardwareFilter);
  renderImages();
});

// Complex filter
document.querySelector(".filter-button[data-complex]").addEventListener("click",e=>{
  if(activeComplexFilter){ activeComplexFilter=null; e.target.classList.remove("active");}
  else{ activeComplexFilter=true; e.target.classList.add("active");}
  renderImages();
});

// Clear color
document.querySelector(".clear-colors").addEventListener("click",()=>{
  activeThemeFilter=null;
  document.querySelectorAll(".color-filter").forEach(b=>b.classList.remove("active"));
  renderImages();
});

// Size controls
document.getElementById("increase").addEventListener("click",()=>{currentSize+=20; renderImages();});
document.getElementById("decrease").addEventListener("click",()=>{if(currentSize>40){currentSize-=20; renderImages();}});

// Sorting select
document.getElementById("sortSelect").addEventListener("change",e=>{
  sortOrder = e.target.value;
  renderImages();
});

loadImages();
</script>
</body>
</html>
